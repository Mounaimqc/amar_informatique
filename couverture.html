<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <title>Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ - Amar Informatique</title>

  <link rel="icon" href="logo.jpg" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // Robust capturer for amCharts geodata
    window.algeriaGeoJSON = null;
    window.am4internal_webpackJsonp = function (id, modules) {
      for (let key in modules) {
        try {
          // Execute the module function with dummy arguments
          // This triggers 'window.am4geodata_algeriaHigh = ...' internal logic
          modules[key]({}, {}, {});
          console.log("Executed module:", key);
        } catch (e) {
          // Some modules might need real amCharts environment, but map data usually doesn't
          console.warn("Module exec warning for " + key + ":", e);
        }
      }
      if (window.am4geodata_algeriaHigh) {
        window.algeriaGeoJSON = window.am4geodata_algeriaHigh;
        console.log("Map data captured via execution.");
      }
    };
  </script>
  <script src="algeria_data.js" defer></script>

  <style>
    :root {
      --bg-dark: #0f172a;
      --bg-card: rgba(30, 41, 59, 0.7);
      --primary-color: #7c3aed;
      --primary-glow: #8b5cf6;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --glass-border: 1px solid rgba(255, 255, 255, 0.1);
      --neon-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
      --radius-lg: 20px;
      --transition: all 0.3s ease;
      --glass-bg: rgba(255, 255, 255, 0.03);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    header {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: var(--glass-border);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: min(92%, 1400px);
      margin: 0 auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .logo img {
      height: 42px
    }

    .logo h1 {
      font-size: 1.4rem;
      font-weight: 800;
      background: linear-gradient(135deg, #fff, var(--primary-color));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .btn-nav {
      padding: 10px 18px;
      border-radius: 12px;
      font-weight: 600;
      background: rgba(124, 58, 237, 0.1);
      color: var(--primary-color);
      border: 1px solid rgba(124, 58, 237, 0.3);
      text-decoration: none;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 44px;
    }

    .btn-nav:hover {
      background: rgba(124, 58, 237, 0.2);
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.4);
    }

    .coverage-section {
      padding: 60px 20px;
      max-width: 1400px;
      margin: auto;
      text-align: center;
    }

    .coverage-title {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #fff, var(--primary-glow));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .coverage-subtitle {
      color: var(--text-muted);
      margin-bottom: 40px;
    }

    .search-input {
      width: 100%;
      max-width: 500px;
      padding: 15px 25px;
      border-radius: 50px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(15, 23, 42, 0.6);
      color: white;
      margin-bottom: 40px;
      outline: none;
      transition: var(--transition);
    }

    .search-input:focus {
      border-color: var(--primary-color);
      box-shadow: var(--neon-shadow);
    }

    .content-grid {
      display: flex;
      flex-direction: column;
      gap: 30px;
      align-items: center;
      width: 100%;
    }

    .map-wrapper {
      background: var(--bg-card);
      backdrop-filter: blur(16px);
      border-radius: var(--radius-lg);
      padding: 0;
      /* Remove padding for edge-to-edge map feel */
      box-shadow: 0 12px 48px 0 rgba(0, 0, 0, 0.5);
      border: var(--glass-border);
      position: relative;
      width: 100%;
      max-width: 1200px;
      /* Centered and prominent */
      height: 650px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow: hidden;
      /* Important for zoom/pan containment */
    }

    #map-svg-container {
      width: 100%;
      height: auto;
      position: relative;
    }

    svg {
      width: 100%;
      height: auto;
      max-height: 700px;
      filter: drop-shadow(0 0 10px rgba(124, 58, 237, 0.1));
    }

    path:hover {
      fill: rgba(139, 92, 246, 0.9);
      stroke: #fff;
      stroke-width: 1.5;
      filter: drop-shadow(0 0 12px var(--primary-glow));
      z-index: 10;
    }

    path.highlight {
      fill: var(--primary-color) !important;
      stroke: #fff;
      stroke-width: 2;
      filter: drop-shadow(0 0 20px var(--primary-color));
      animation: pulseHighlight 2s infinite;
    }

    @keyframes pulseHighlight {
      0% {
        filter: drop-shadow(0 0 5px var(--primary-color));
      }

      50% {
        filter: drop-shadow(0 0 25px var(--primary-color));
      }

      100% {
        filter: drop-shadow(0 0 5px var(--primary-color));
      }
    }

    /* Category Colors */
    .speed-fast {
      fill: #10b981;
      fill-opacity: 0.35;
    }

    .speed-medium {
      fill: #f59e0b;
      fill-opacity: 0.35;
    }

    .speed-slow {
      fill: #ef4444;
      fill-opacity: 0.35;
    }

    #map-viewport {
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Zoom Controls */
    .zoom-controls {
      position: absolute;
      bottom: 25px;
      right: 25px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .zoom-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.8);
      border: var(--glass-border);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: var(--transition);
    }

    .zoom-btn:hover {
      background: var(--primary-color);
      transform: scale(1.1);
    }

    /* Legend */
    .legend-card {
      margin-top: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .legend-color {
      width: 14px;
      height: 14px;
      border-radius: 3px;
    }

    #sidebar {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 1200px;
      margin-top: 20px;
    }

    .glass-card {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      border: var(--glass-border);
      padding: 25px;
      text-align: left;
      flex: 1;
      min-width: 300px;
    }

    .glass-card h2 {
      font-size: 1.25rem;
      margin-bottom: 20px;
      color: var(--primary-glow);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding-bottom: 10px;
    }

    .wilaya-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .wilaya-detail-row span:first-child {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .wilaya-detail-row span:last-child {
      font-weight: 600;
      color: var(--text-main);
    }

    .map-tooltip {
      position: fixed;
      background: rgba(15, 23, 42, 0.95);
      padding: 12px 18px;
      border-radius: 10px;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
      border: 1px solid var(--primary-color);
      min-width: 180px;
      z-index: 2000;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
    }

    .map-tooltip.show {
      opacity: 1
    }

    .tooltip-row {
      display: flex;
      justify-content: space-between;
      margin: 4px 0;
      font-size: .85rem;
    }

    .tooltip-title {
      color: var(--primary-glow);
      font-weight: 800;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 4px;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      margin-top: 60px;
      color: var(--text-muted);
    }

    @media (max-width: 768px) {
      .content-grid {
        grid-template-columns: 1fr;
      }

      #sidebar {
        order: -1;
      }

      .btn-nav span {
        display: none;
      }

      .btn-nav {
        width: 44px;
        height: 44px;
        padding: 10px;
        justify-content: center;
      }

      .btn-nav i {
        font-size: 1.2rem;
      }
    }

    @media (max-width: 480px) {
      .logo h1 {
        display: none;
      }
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      margin-top: 60px;
      color: var(--text-muted);
    }
  </style>
</head>

<body>

  <header>
    <nav class="navbar">
      <div class="container">
        <div class="logo">
          <img src="logo.jpg">
          <h1>Amar Informatique</h1>
        </div>
        <a href="index.html" class="btn-nav"><i class="fas fa-store"></i> <span>Boutique</span></a>
      </div>
    </nav>
  </header>

  <section class="coverage-section">

    <h1 class="coverage-title">ğŸ“ COUVERTURE DE LIVRAISON</h1>
    <p class="coverage-subtitle">Nous couvrons 58 Wilayas du territoire national algÃ©rien</p>

    <input type="text" id="wilayaSearch" class="search-input" placeholder="ğŸ”  Chercher ">

    <div class="content-grid">
      <div class="zoom-controls">
        <button class="zoom-btn" onclick="adjustZoom(1.2)" title="Zoom In"><i class="fas fa-plus"></i></button>
        <button class="zoom-btn" onclick="adjustZoom(1/1.2)" title="Zoom Out"><i class="fas fa-minus"></i></button>
        <button class="zoom-btn" onclick="resetView()" title="Reset View"><i
            class="fas fa-expand-arrows-alt"></i></button>
      </div>
      <div id="map-svg-container">
        <div class="loader">Loading Map...</div>
      </div>
    </div>

    <div id="sidebar">
      <div class="glass-card">
        <h2><i class="fas fa-info-circle"></i> Wilaya Details</h2>
        <div id="wilaya-info">
          <p style="color:var(--text-muted); font-style: italic;">Hover over a wilaya to see details</p>
        </div>
      </div>
      <div class="glass-card legend-card">
        <h2><i class="fas fa-layer-group"></i> ExpÃ©dition</h2>
        <div class="legend-item">
          <div class="legend-color" style="background: #10b981; border: 1px solid #059669;"></div>
          <span style="font-size: 0.85rem;">Rapide (24h - 48h)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #f59e0b; border: 1px solid #d97706;"></div>
          <span style="font-size: 0.85rem;">Moyenne (48h - 72h)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ef4444; border: 1px solid #dc2626;"></div>
          <span style="font-size: 0.85rem;">Longue (72h+)</span>
        </div>
      </div>
    </div>

    <div class="map-tooltip" id="mapTooltip"></div>
  </section>

  <footer>
    &copy; 2026 Amar Informatique. Premium Tech Store.
  </footer>

  <script>
    const wilayasData = {
      "1": { name: "Adrar", nameAr: "Ø£Ø¯Ø±Ø§Ø±", code: "01", time: "24h Ã  120h", home: 1500, desk: 1000 },
      "2": { name: "Chlef", nameAr: "Ø§Ù„Ø´Ù„Ù", code: "02", time: "24h Ã  48h", home: 700, desk: 450 },
      "3": { name: "Laghouat", nameAr: "Ø§Ù„Ø£ØºÙˆØ§Ø·", code: "03", time: "24h Ã  96h", home: 900, desk: 600 },
      "4": { name: "Oum El Bouaghi", nameAr: "Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ", code: "04", time: "24h Ã  72h", home: 800, desk: 500 },
      "5": { name: "Batna", nameAr: "Ø¨Ø§ØªÙ†Ø©", code: "05", time: "24h Ã  48h", home: 700, desk: 450 },
      "6": { name: "BÃ©jaÃ¯a", nameAr: "Ø¨Ø¬Ø§ÙŠØ©", code: "06", time: "24h Ã  48h", home: 700, desk: 450 },
      "7": { name: "Biskra", nameAr: "Ø¨Ø³ÙƒØ±Ø©", code: "07", time: "24h Ã  72h", home: 900, desk: 500 },
      "8": { name: "BÃ©char", nameAr: "Ø¨Ø´Ø§Ø±", code: "08", time: "24h Ã  120h", home: 1200, desk: 800 },
      "9": { name: "Blida", nameAr: "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©", code: "09", time: "24h Ã  48h", home: 700, desk: 450 },
      "10": { name: "Bouira", nameAr: "Ø§Ù„Ø¨ÙˆÙŠØ±Ø©", code: "10", time: "24h Ã  48h", home: 700, desk: 450 },
      "11": { name: "Tamanrasset", nameAr: "ØªÙ…Ù†Ø±Ø§Ø³Øª", code: "11", time: "120h Ã  172h", home: 2000, desk: 1500 },
      "12": { name: "TÃ©bessa", nameAr: "ØªØ¨Ø³Ø©", code: "12", time: "48h Ã  72h", home: 850, desk: 500 },
      "13": { name: "Tlemcen", nameAr: "ØªÙ„Ù…Ø³Ø§Ù†", code: "13", time: "24h Ã  48h", home: 800, desk: 500 },
      "14": { name: "Tiaret", nameAr: "ØªÙŠØ§Ø±Øª", code: "14", time: "48h Ã  72h", home: 800, desk: 500 },
      "15": { name: "Tizi Ouzou", nameAr: "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ", code: "15", time: "24h Ã  48h", home: 700, desk: 450 },
      "16": { name: "Alger", nameAr: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", code: "16", time: "24h Ã  48h", home: 600, desk: 400 },
      "17": { name: "Djelfa", nameAr: "Ø§Ù„Ø¬Ù„ÙØ©", code: "17", time: "48h Ã  72h", home: 900, desk: 600 },
      "18": { name: "Jijel", nameAr: "Ø¬ÙŠØ¬Ù„", code: "18", time: "24h Ã  48h", home: 700, desk: 450 },
      "19": { name: "SÃ©tif", nameAr: "Ø³Ø·ÙŠÙ", code: "19", time: "24h Ã  48h", home: 550, desk: 300 },
      "20": { name: "SaÃ¯da", nameAr: "Ø³Ø¹ÙŠØ¯Ø©", code: "20", time: "48h Ã  72h", home: 900, desk: 500 },
      "21": { name: "Skikda", nameAr: "Ø³ÙƒÙŠÙƒØ¯Ø©", code: "21", time: "24h Ã  48h", home: 800, desk: 500 },
      "22": { name: "Sidi Bel AbbÃ¨s", nameAr: "Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³", code: "22", time: "24h Ã  48h", home: 800, desk: 500 },
      "23": { name: "Annaba", nameAr: "Ø¹Ù†Ø§Ø¨Ø©", code: "23", time: "24h Ã  48h", home: 700, desk: 450 },
      "24": { name: "Guelma", nameAr: "Ù‚Ø§Ù„Ù…Ø©", code: "24", time: "24h Ã  48h", home: 850, desk: 500 },
      "25": { name: "Constantine", nameAr: "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", code: "25", time: "24h Ã  48h", home: 650, desk: 400 },
      "26": { name: "MÃ©dÃ©a", nameAr: "Ø§Ù„Ù…Ø¯ÙŠØ©", code: "26", time: "48h Ã  72h", home: 800, desk: 500 },
      "27": { name: "Mostaganem", nameAr: "Ù…Ø³ØªØºØ§Ù†Ù…", code: "27", time: "24h Ã  48h", home: 800, desk: 500 },
      "28": { name: "M'Sila", nameAr: "Ø§Ù„Ù…Ø³ÙŠÙ„Ø©", code: "28", time: "48h Ã  72h", home: 700, desk: 450 },
      "29": { name: "Mascara", nameAr: "Ù…Ø¹Ø³ÙƒØ±", code: "29", time: "24h Ã  48h", home: 800, desk: 500 },
      "30": { name: "Ouargla", nameAr: "ÙˆØ±Ù‚Ù„Ø©", code: "30", time: "72h Ã  96h", home: 1000, desk: 600 },
      "31": { name: "Oran", nameAr: "ÙˆÙ‡Ø±Ø§Ù†", code: "31", time: "24h Ã  48h", home: 700, desk: 450 },
      "32": { name: "El Bayadh", nameAr: "Ø§Ù„Ø¨ÙŠØ¶", code: "32", time: "72h Ã  96h", home: 1200, desk: 800 },
      "33": { name: "Illizi", nameAr: "Ø¥Ù„ÙŠØ²ÙŠ", code: "33", time: "72h Ã  96h", home: 1900, desk: 1500 },
      "34": { name: "Bordj Bou ArrÃ©ridj", nameAr: "Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬", code: "34", time: "24h Ã  48h", home: 600, desk: 400 },
      "35": { name: "BoumerdÃ¨s", nameAr: "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³", code: "35", time: "24h Ã  48h", home: 700, desk: 450 },
      "36": { name: "El Tarf", nameAr: "Ø§Ù„Ø·Ø§Ø±Ù", code: "36", time: "24h Ã  48h", home: 850, desk: 500 },
      "37": { name: "Tindouf", nameAr: "ØªÙ†Ø¯ÙˆÙ", code: "37", time: "72h Ã  96h", home: 1700, desk: 1000 },
      "38": { name: "Tissemsilt", nameAr: "ØªØ³Ù…Ø³ÙŠÙ„Øª", code: "38", time: "48h Ã  72h", home: 850, desk: 500 },
      "39": { name: "El Oued", nameAr: "Ø§Ù„ÙˆØ§Ø¯ÙŠ", code: "39", time: "72h Ã  96h", home: 1000, desk: 600 },
      "40": { name: "KhencheÙ„Ø§", nameAr: "Ø®Ù†Ø´Ù„Ø©", code: "40", time: "48h Ã  72h", home: 600, desk: 500 },
      "41": { name: "Souk Ahras", nameAr: "Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³", code: "41", time: "24h Ã  48h", home: 850, desk: 500 },
      "42": { name: "Tipaza", nameAr: "ØªÙŠØ¨Ø§Ø²Ø©", code: "42", time: "24h Ã  48h", home: 600, desk: 450 },
      "43": { name: "Mila", nameAr: "Ù…ÙŠÙ„Ø©", code: "43", time: "24h Ã  48h", home: 600, desk: 500 },
      "44": { name: "AÃ¯n Defla", nameAr: "Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰", code: "44", time: "48h Ã  72h", home: 800, desk: 500 },
      "45": { name: "NaÃ¢ma", nameAr: "Ø§Ù„Ù†Ø¹Ø§Ù…Ø©", code: "45", time: "72h Ã  96h", home: 1200, desk: 800 },
      "46": { name: "AÃ¯n TÃ©mouchent", nameAr: "Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª", code: "46", time: "24h Ã  48h", home: 800, desk: 500 },
      "47": { name: "GhardaÃ¯a", nameAr: "ØºØ±Ø¯Ø§ÙŠØ©", code: "47", time: "72h Ã  96h", home: 1000, desk: 600 },
      "48": { name: "Relizane", nameAr: "ØºÙ„ÙŠØ²Ø§Ù†", code: "48", time: "24h Ã  48h", home: 800, desk: 500 },
      "49": { name: "Timimoun", nameAr: "ØªÙ…ÙŠÙ…ÙˆÙ†", code: "49", time: "72h Ã  96h", home: 1500, desk: 1000 },
      "50": { name: "Bordj Badji Mokhtar", nameAr: "Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±", code: "50", time: "72h Ã  96h", home: 1600, desk: 1500 },
      "51": { name: "Ouled Djellal", nameAr: "Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„", code: "51", time: "72h Ã  96h", home: 900, desk: 500 },
      "52": { name: "BÃ©ni AbbÃ¨s", nameAr: "Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³", code: "52", time: "72h Ã  96h", home: 1200, desk: 800 },
      "53": { name: "In Salah", nameAr: "Ø¹ÙŠÙ† ØµØ§Ù„Ø­", code: "53", time: "72h Ã  96h", home: 1800, desk: 1200 },
      "54": { name: "In Guezzam", nameAr: "Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…", code: "54", time: "72h Ã  96h", home: 2200, desk: 3500 },
      "55": { name: "Touggourt", nameAr: "ØªÙ‚Ø±Øª", code: "55", time: "72h Ã  96h", home: 1000, desk: 600 },
      "56": { name: "Djanet", nameAr: "Ø¬Ø§Ù†Øª", code: "56", time: "72h Ã  96h", home: 2000, desk: 3500 },
      "57": { name: "El M'Ghair", nameAr: "Ø§Ù„Ù…ØºÙŠØ±", code: "57", time: "72h Ã  96h", home: 1000, desk: 1800 },
      "58": { name: "El Meniaa", nameAr: "Ø§Ù„Ù…Ù†ÙŠØ¹Ø©", code: "58", time: "72h Ã  96h", home: 1000, desk: 600 }
    };

    const tooltip = document.getElementById("mapTooltip");
    const wilayaInfo = document.getElementById("wilaya-info");
    const mapContainer = document.getElementById("map-svg-container");
    let geoJsonData = null;
    let currentScale = 1;
    let currentTranslate = { x: 0, y: 0 };
    let isPanning = false;
    let startPan = { x: 0, y: 0 };

    async function loadMapData() {
      console.log("Starting map data load process...");

      // Tier 1: Check if already captured by robust script tag capturer
      for (let i = 0; i < 5; i++) {
        if (window.algeriaGeoJSON || window.am4geodata_algeriaHigh) {
          geoJsonData = window.algeriaGeoJSON || window.am4geodata_algeriaHigh;
          console.log("Map data found in memory.");
          renderMap(geoJsonData);
          return;
        }
        await new Promise(r => setTimeout(r, 200));
      }

      // Tier 2: Try to load from amCharts CDN (Reliable and bypasses CORS)
      console.log("Local capture failed, trying CDN...");
      try {
        const cdnPromise = new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = "https://www.amcharts.com/lib/4/geodata/algeriaHigh.js";
          script.onload = () => {
            if (window.am4geodata_algeriaHigh) resolve(window.am4geodata_algeriaHigh);
            else reject("CDN load failed (variable not set)");
          };
          script.onerror = () => reject("CDN script load error");
          document.head.appendChild(script);
        });

        // Wait up to 3 seconds for CDN
        const cdnData = await Promise.race([
          cdnPromise,
          new Promise((_, reject) => setTimeout(() => reject("CDN timeout"), 3000))
        ]);

        if (cdnData) {
          console.log("Map data loaded from CDN.");
          geoJsonData = cdnData;
          renderMap(geoJsonData);
          return;
        }
      } catch (cdnError) {
        console.warn("CDN fallback failed:", cdnError);
      }

      // Tier 3: Last resort fallback to fetch (likely to fail on file:// but good for http://)
      try {
        const response = await fetch('algeria_data.js');
        const text = await response.text();
        const startStr = '{"type":"FeatureCollection"';
        const startIndex = text.indexOf(startStr);
        if (startIndex !== -1) {
          let endIndex = text.lastIndexOf('}]}');
          if (endIndex !== -1) {
            geoJsonData = JSON.parse(text.substring(startIndex, endIndex + 3));
            console.log("Map data loaded via fetch fallback.");
            renderMap(geoJsonData);
            return;
          }
        }
      } catch (fetchError) {
        console.error("Fetch fallback failed:", fetchError);
      }

      // Final failure
      mapContainer.innerHTML = `
        <div style="color:#ff4d4d;padding:30px;background:rgba(255,100,100,0.1);border:1px solid rgba(255,100,100,0.2);border-radius:15px;margin-top:20px;text-align:center;">
          <i class="fas fa-exclamation-triangle" style="font-size:2rem;margin-bottom:15px;display:block;"></i>
          <h3 style="margin-bottom:10px;">Impossible de charger la carte</h3>
          <p style="color:var(--text-muted);font-size:0.9rem;">
            La sÃ©curitÃ© de votre navigateur bloque l'accÃ¨s aux donnÃ©es locales.<br>
            <b>Solution :</b> Utilisez un serveur local (Live Server) ou connectez-vous Ã  Internet pour charger depuis le CDN.
          </p>
        </div>`;
    }

    function renderMap(geoData) {
      mapContainer.innerHTML = '';
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("viewBox", "0 0 800 650");
      svg.setAttribute("preserveAspectRatio", "xMidYMid meet");
      svg.style.cursor = "grab";
      svg.style.width = "100%";
      svg.style.height = "100%";

      const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
      g.setAttribute("id", "map-viewport");
      // Add a base group for coordinate system normalization
      const zoomG = document.createElementNS("http://www.w3.org/2000/svg", "g");
      zoomG.setAttribute("id", "zoom-group");
      g.appendChild(zoomG);
      svg.appendChild(g);

      // Pan & Zoom Logic
      let isDragging = false;
      let startX, startY;

      svg.addEventListener('mousedown', e => {
        isDragging = true;
        svg.style.cursor = "grabbing";
        startX = e.clientX - currentTranslate.x;
        startY = e.clientY - currentTranslate.y;
        g.style.transition = 'none'; // Disable transition during manual pan
      });

      window.addEventListener('mousemove', e => {
        if (!isDragging) return;
        currentTranslate.x = e.clientX - startX;
        currentTranslate.y = e.clientY - startY;
        updateTransform();
      });

      window.addEventListener('mouseup', () => {
        isDragging = false;
        svg.style.cursor = "grab";
      });

      svg.addEventListener('wheel', e => {
        e.preventDefault();
        const delta = e.deltaY > 0 ? 0.9 : 1.1;

        // Cursor-centric zoom logic
        const pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const svgPt = pt.matrixTransform(svg.getScreenCTM().inverse());

        const prevScale = currentScale;
        currentScale *= delta;
        currentScale = Math.max(0.5, Math.min(currentScale, 15));

        const scaleDiff = currentScale / prevScale;
        currentTranslate.x = svgPt.x - (svgPt.x - currentTranslate.x) * scaleDiff;
        currentTranslate.y = svgPt.y - (svgPt.y - currentTranslate.y) * scaleDiff;

        g.style.transition = 'none';
        updateTransform();
      }, { passive: false });

      // Double Click to Zoom
      svg.addEventListener('dblclick', e => {
        const delta = 1.5;
        const pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const svgPt = pt.matrixTransform(svg.getScreenCTM().inverse());

        const prevScale = currentScale;
        currentScale *= delta;
        currentScale = Math.max(0.5, Math.min(currentScale, 15));

        const scaleDiff = currentScale / prevScale;
        currentTranslate.x = svgPt.x - (svgPt.x - currentTranslate.x) * scaleDiff;
        currentTranslate.y = svgPt.y - (svgPt.y - currentTranslate.y) * scaleDiff;

        g.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        updateTransform();
      });

      function updateTransform() {
        g.setAttribute("transform", `translate(${currentTranslate.x}, ${currentTranslate.y}) scale(${currentScale})`);
      }
      window.updateTransform = updateTransform;

      window.adjustZoom = (delta) => {
        // Zoom relative to center
        const prevScale = currentScale;
        currentScale *= delta;
        currentScale = Math.max(0.5, Math.min(currentScale, 15));

        const scaleDiff = currentScale / prevScale;
        currentTranslate.x = 400 - (400 - currentTranslate.x) * scaleDiff;
        currentTranslate.y = 325 - (325 - currentTranslate.y) * scaleDiff;

        g.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        updateTransform();
      };

      window.resetView = () => {
        currentScale = 1;
        currentTranslate = { x: 0, y: 0 };
        g.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
        updateTransform();
        document.querySelectorAll('path').forEach(p => p.classList.remove('highlight'));
      };

      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
      geoData.features.forEach(feature => {
        const coords = feature.geometry.coordinates;
        coords.forEach(polygon => {
          const points = feature.geometry.type === "MultiPolygon" ? polygon[0] : polygon;
          points.forEach(p => {
            if (p[0] < minX) minX = p[0];
            if (p[0] > maxX) maxX = p[0];
            if (p[1] < minY) minY = p[1];
            if (p[1] > maxY) maxY = p[1];
          });
        });
      });

      const scaleFactor = Math.min(760 / (maxX - minX), 600 / (maxY - minY));
      const offsetX = (800 - (maxX - minX) * scaleFactor) / 2 - minX * scaleFactor;
      const offsetY = (650 - (maxY - minY) * scaleFactor) / 2 - minY * scaleFactor;

      geoData.features.forEach(feature => {
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        let d = "";

        const project = (polygon) => {
          let pd = "";
          polygon.forEach((ring) => {
            ring.forEach((p, j) => {
              const x = p[0] * scaleFactor + offsetX;
              const y = 650 - (p[1] * scaleFactor + offsetY);
              pd += (j === 0 ? "M" : "L") + x.toFixed(1) + "," + y.toFixed(1);
            });
            pd += "Z";
          });
          return pd;
        };

        if (feature.geometry.type === "Polygon") d = project(feature.geometry.coordinates);
        else if (feature.geometry.type === "MultiPolygon") feature.geometry.coordinates.forEach(poly => d += project(poly));

        path.setAttribute("d", d);
        path.setAttribute("id", feature.id);

        // Calculate Centroid (for auto-zoom)
        let cX = 0, cY = 0, count = 0;
        feature.geometry.coordinates.forEach(polygon => {
          const points = feature.geometry.type === "MultiPolygon" ? polygon[0] : polygon;
          points.forEach(p => {
            cX += p[0] * scaleFactor + offsetX;
            cY += 650 - (p[1] * scaleFactor + offsetY);
            count++;
          });
        });
        path.setAttribute("data-cx", cX / count);
        path.setAttribute("data-cy", cY / count);

        // Apply Speed Colors
        const wilayaNum = feature.id.split("-")[1];
        const wData = wilayasData[parseInt(wilayaNum)];
        if (wData) {
          const hours = parseInt(wData.time);
          if (hours <= 48) path.classList.add('speed-fast');
          else if (hours <= 72) path.classList.add('speed-medium');
          else path.classList.add('speed-slow');
        }

        path.addEventListener('mouseenter', (e) => {
          const wilayaNum = feature.id.split("-")[1];
          const data = wilayasData[parseInt(wilayaNum)] || { name: feature.properties.name, nameAr: "", time: "N/A", home: "N/A", desk: "N/A" };

          tooltip.innerHTML = `<div class="tooltip-title">${data.name} | ${data.nameAr}</div>
                                 <div class="tooltip-row"><span>ğŸ  Home:</span><span>${data.home} DA</span></div>
                                 <div class="tooltip-row"><span>ğŸª Desk:</span><span>${data.desk} DA</span></div>`;
          tooltip.classList.add('show');

          wilayaInfo.innerHTML = `
                <div class="wilaya-detail-row"><span>Wilaya:</span><span>${data.name} (${data.code})</span></div>
                <div class="wilaya-detail-row"><span>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</span><span>${data.nameAr}</span></div>
                <div class="wilaya-detail-row"><span>Duration:</span><span>${data.time}</span></div>
                <div class="wilaya-detail-row"><span>Home Price:</span><span>${data.home} DA</span></div>
                <div class="wilaya-detail-row"><span>Desk Price:</span><span>${data.desk} DA</span></div>`;
        });

        path.addEventListener('mousemove', (e) => {
          tooltip.style.left = (e.clientX + 15) + 'px';
          tooltip.style.top = (e.clientY + 15) + 'px';
        });

        path.addEventListener('mouseleave', () => tooltip.classList.remove('show'));
        path.addEventListener('click', () => {
          document.querySelectorAll('path').forEach(p => p.classList.remove('highlight'));
          path.classList.add('highlight');
        });

        g.appendChild(path);
      });
      mapContainer.appendChild(svg);
    }

    const handleSearch = () => {
      const val = document.getElementById("wilayaSearch").value.toLowerCase().trim();
      let found = false;

      document.querySelectorAll('path').forEach(path => {
        const wilayaNum = path.id.split("-")[1];
        const data = wilayasData[parseInt(wilayaNum)];
        if (!data) return;

        const matches = data.name.toLowerCase().includes(val) ||
          data.nameAr.includes(val) ||
          data.code === val;

        if (val === "") {
          path.style.opacity = "1";
          path.classList.remove('highlight');
        } else {
          if (matches) {
            path.style.opacity = "1";
            path.classList.add('highlight');
            if (!found) {
              const cx = parseFloat(path.getAttribute("data-cx"));
              const cy = parseFloat(path.getAttribute("data-cy"));
              currentScale = 2.5;
              currentTranslate.x = 400 - (cx * currentScale);
              currentTranslate.y = 325 - (cy * currentScale);
              updateTransform();

              // Trigger the info for the first match
              path.dispatchEvent(new Event('mouseenter'));
              found = true;
            }
          } else {
            path.style.opacity = "0.1";
            path.classList.remove('highlight');
          }
        }
      });
    };

    document.getElementById("wilayaSearch").addEventListener("input", handleSearch);
    document.getElementById("wilayaSearch").addEventListener("keypress", (e) => {
      if (e.key === "Enter") handleSearch();
    });

    window.onload = loadMapData;
  </script>

</body>

</html>
