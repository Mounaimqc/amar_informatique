<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Amar Informatique</title>
<link rel="icon" href="logo.jpg" type="image/x-icon">
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyAUjSJTplPn9O8pK_YU5ydsyqUQ9HVfKXo",
    authDomain: "amar-informatique.firebaseapp.com",
    projectId: "amar-informatique",
    storageBucket: "amar-informatique.firebasestorage.app",
    messagingSenderId: "568367870390",
    appId: "1:568367870390:web:e1583c182272ecbf141117"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
<style>
:root {
    --primary: #6366f1; --primary-dark: #4f46e5; --primary-light: #818cf8;
    --secondary: #ec4899; --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
    --bg-main: #0f172a; --bg-card: #1e293b; --bg-hover: #334155;
    --text-main: #f1f5f9; --text-muted: #94a3b8;
    --border: rgba(255,255,255,0.1); --radius: 12px; --radius-lg: 16px;
    --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',sans-serif; background:var(--bg-main); color:var(--text-main); min-height:100vh; }
header { background:rgba(30,41,59,0.8); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; }
.navbar { max-width:1600px; margin:0 auto; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
.logo h1 { font-size:1.5rem; font-weight:700; background:linear-gradient(135deg,var(--primary),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.nav-items { display:flex; gap:1rem; align-items:center; }
.btn { padding:0.75rem 1.5rem; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer; transition:var(--transition); display:inline-flex; align-items:center; gap:0.5rem; text-decoration:none; }
.btn-primary { background:linear-gradient(135deg,var(--primary),var(--primary-dark)); color:white; }
.btn-secondary { background:var(--bg-hover); color:var(--text-main); border:1px solid var(--border); }
.btn-success { background:linear-gradient(135deg,var(--success),#059669); color:white; }
.btn-danger { background:linear-gradient(135deg,var(--danger),#dc2626); color:white; }
.btn-warning { background:linear-gradient(135deg,var(--warning),#d97706); color:white; }
.btn-sm { padding:0.5rem 1rem; font-size:0.85rem; }
.admin-container { max-width:1600px; margin:0 auto; padding:2rem; }
.page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; padding-bottom:1.5rem; border-bottom:1px solid var(--border); flex-wrap:wrap; gap:1rem; }
.page-title h1 { font-size:2rem; font-weight:800; }
.page-actions { display:flex; gap:0.75rem; flex-wrap:wrap; }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; margin-bottom:2rem; }
.stat-card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-lg); padding:1.5rem; transition:var(--transition); }
.stat-card:hover { transform:translateY(-5px); }
.stat-number { font-size:2rem; font-weight:800; margin-bottom:0.25rem; }
.stat-label { font-size:0.9rem; color:var(--text-muted); }
.filters-bar { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-lg); padding:1.5rem; margin-bottom:2rem; display:flex; gap:1rem; flex-wrap:wrap; align-items:center; }
.filter-group { display:flex; flex-direction:column; gap:0.5rem; flex:1; min-width:200px; }
.filter-group label { font-size:0.85rem; font-weight:600; color:var(--text-muted); }
.filter-input { padding:0.75rem 1rem; background:var(--bg-main); border:1px solid var(--border); border-radius:var(--radius); color:var(--text-main); }
.filter-input:focus { outline:none; border-color:var(--primary); }
.table-container { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-lg); overflow:hidden; }
.table-header { padding:1.5rem; border-bottom:1px solid var(--border); }
.orders-table { width:100%; border-collapse:collapse; }
.orders-table thead { background:var(--bg-main); }
.orders-table th { padding:1rem 1.5rem; text-align:left; font-size:0.85rem; font-weight:600; color:var(--text-muted); text-transform:uppercase; }
.orders-table td { padding:1.25rem 1.5rem; border-bottom:1px solid var(--border); }
.orders-table tbody tr:hover { background:var(--bg-hover); }
.status-badge { display:inline-flex; align-items:center; gap:0.5rem; padding:0.5rem 1rem; border-radius:50px; font-size:0.85rem; font-weight:600; }
.status-pending { background:rgba(245,158,11,0.2); color:#fbbf24; }
.status-accepted { background:rgba(59,130,246,0.2); color:#60a5fa; }
.status-shipped { background:rgba(139,92,246,0.2); color:#a78bfa; }
.status-arrived { background:rgba(16,185,129,0.2); color:#34d399; }
.status-returned { background:rgba(239,68,68,0.2); color:#f87171; }
.action-buttons { display:flex; gap:8px; align-items:center; }
.btn-details { background:linear-gradient(135deg,#667eea,#764ba2); color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all 0.3s ease; }
.btn-details:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,0.6); }
.btn-delete { background:linear-gradient(135deg,#f093fb,#f5576c); color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all 0.3s ease; }
.btn-delete:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(245,87,108,0.6); }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(10px); }
.modal.active { display:flex; align-items:center; justify-content:center; }
.modal-content { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-lg); max-width:700px; width:90%; max-height:90vh; overflow-y:auto; }
.modal-header { padding:1.5rem 2rem; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.modal-close { width:40px; height:40px; border-radius:var(--radius); border:none; background:var(--bg-hover); color:var(--text-muted); cursor:pointer; font-size:1.5rem; }
.modal-close:hover { background:var(--danger); color:white; }
.modal-body { padding:2rem; }
.detail-section { margin-bottom:2rem; }
.section-title { font-size:1rem; font-weight:700; margin-bottom:1rem; display:flex; align-items:center; gap:0.5rem; padding-bottom:0.75rem; border-bottom:1px solid var(--border); }
.detail-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
.detail-item { display:flex; flex-direction:column; gap:0.25rem; }
.detail-label { font-size:0.85rem; color:var(--text-muted); }
.detail-value { font-size:1rem; font-weight:600; }
.products-list { background:var(--bg-main); border-radius:var(--radius); padding:1rem; max-height:300px; overflow-y:auto; }
.item-entry { display:flex; justify-content:space-between; padding:0.75rem 0; border-bottom:1px solid var(--border); }
.item-entry:last-child { border-bottom:none; }
.total-section { background:var(--bg-main); border-radius:var(--radius); padding:1.5rem; margin-top:1.5rem; }
.total-row { display:flex; justify-content:space-between; padding:0.75rem 0; border-bottom:1px solid var(--border); }
.total-row:last-child { border-bottom:none; font-weight:800; font-size:1.25rem; }
.total-value.grand { color:var(--success); }
.form-group { margin-bottom:1.5rem; }
.form-label { display:block; font-size:0.9rem; font-weight:600; margin-bottom:0.5rem; }
.form-input, .form-select, .form-textarea { width:100%; padding:0.75rem 1rem; background:var(--bg-main); border:1px solid var(--border); border-radius:var(--radius); color:var(--text-main); }
.form-input:focus { outline:none; border-color:var(--primary); }
.form-textarea { min-height:100px; resize:vertical; }
.form-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
.image-preview { margin-top:1rem; border-radius:var(--radius); overflow:hidden; }
.image-preview img { width:100%; max-height:200px; object-fit:cover; }
.modal-footer { padding:1.5rem 2rem; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:0.75rem; }
.status-actions { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:0.75rem; margin-top:1rem; }
.status-btn { padding:0.75rem 1rem; border:1px solid var(--border); border-radius:var(--radius); background:var(--bg-main); color:var(--text-main); font-weight:600; cursor:pointer; transition:var(--transition); display:flex; align-items:center; justify-content:center; gap:0.5rem; }
.status-btn.accept { border-color:rgba(59,130,246,0.5); background:rgba(59,130,246,0.1); color:#60a5fa; }
.status-btn.ship { border-color:rgba(139,92,246,0.5); background:rgba(139,92,246,0.1); color:#a78bfa; }
.status-btn.deliver { border-color:rgba(16,185,129,0.5); background:rgba(16,185,129,0.1); color:#34d399; }
.status-btn.return { border-color:rgba(239,68,68,0.5); background:rgba(239,68,68,0.1); color:#f87171; }
.status-btn:hover { transform:translateY(-2px); }
.loading-state { text-align:center; padding:3rem; }
.loading-spinner { width:50px; height:50px; border:4px solid var(--border); border-top-color:var(--primary); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 1rem; }
@keyframes spin { to { transform:rotate(360deg); } }
.notification { position:fixed; top:20px; right:20px; padding:1rem 1.5rem; border-radius:var(--radius); font-weight:600; z-index:9999; animation:slideIn 0.3s ease; }
.notification.success { background:var(--success); color:white; }
.notification.error { background:var(--danger); color:white; }
.notification.new-order { background:linear-gradient(135deg, #f59e0b, #d97706); color:white; }
@keyframes slideIn { from { transform:translateX(100%); opacity:0; } to { transform:translateX(0); opacity:1; } }
@keyframes slideOut { from { transform:translateX(0); opacity:1; } to { transform:translateX(100%); opacity:0; } }
@media (max-width:768px) {
    .page-header { flex-direction:column; align-items:stretch; }
    .page-actions .btn { flex:1; justify-content:center; }
    .filters-bar { flex-direction:column; }
    .filter-group { width:100%; }
    .table-container { overflow-x:auto; }
    .orders-table { min-width:800px; }
    .action-buttons { flex-direction:column; }
    .btn-details, .btn-delete { width:100%; justify-content:center; }
}
</style>
</head>
<body>
<header>
    <nav class="navbar">
        <div class="logo"><h1><i class="fas fa-chart-line"></i> Amar Dashboard</h1></div>
        <div class="nav-items">
            <a href="index.html" class="btn btn-secondary btn-sm"><i class="fas fa-store"></i> Boutique</a>
            <button class="btn btn-danger btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Déconnexion</button>
        </div>
    </nav>
</header>
<main class="admin-container">
    <div class="page-header">
        <div class="page-title"><h1><i class="fas fa-shopping-bag"></i> Gestion des Commandes</h1></div>
        <div class="page-actions">
            <button class="btn btn-success" onclick="openAddProductModal()"><i class="fas fa-plus"></i> Ajouter Produit</button>
            <button class="btn btn-primary" onclick="exportCommandes()"><i class="fas fa-download"></i> Exporter CSV</button>
        </div>
    </div>
    <div class="stats-grid">
        <div class="stat-card"><div class="stat-number" id="totalCommandes">0</div><div class="stat-label">Commandes Totales</div></div>
        <div class="stat-card"><div class="stat-number" id="totalRevenu">0 DA</div><div class="stat-label">Revenu Total</div></div>
        <div class="stat-card"><div class="stat-number" id="totalDomicile">0</div><div class="stat-label">Livraison Domicile</div></div>
        <div class="stat-card"><div class="stat-number" id="totalStopdesk">0</div><div class="stat-label">Stop Desk</div></div>
    </div>
    <div class="filters-bar">
        <div class="filter-group"><label>Rechercher</label><input type="text" id="searchInput" class="filter-input" placeholder="N° commande, client..."></div>
        <div class="filter-group"><label>Type</label><select id="filterType" class="filter-input"><option value="">Tous</option><option value="domicile">Domicile</option><option value="stopdesk">Stop Desk</option></select></div>
        <div class="filter-group"><label>Wilaya</label><select id="filterWilaya" class="filter-input"><option value="">Toutes</option></select></div>
        <div class="filter-group"><label>&nbsp;</label><button class="btn btn-secondary" onclick="clearFilters()">Reset</button></div>
    </div>
    <div class="table-container">
        <div class="table-header"><div class="table-title"><i class="fas fa-list"></i> Liste des Commandes</div></div>
        <table class="orders-table">
            <thead><tr><th>N° Commande</th><th>Client</th><th>Type</th><th>Wilaya</th><th>Total</th><th>Statut</th><th>Actions</th></tr></thead>
            <tbody id="ordersTableBody"><tr><td colspan="7" class="loading-state"><div class="loading-spinner"></div>Chargement...</td></tr></tbody>
        </table>
    </div>
</main>

<!-- ✅ Modal Détails Commande -->
<div class="modal" id="detailModal">
    <div class="modal-content">
        <div class="modal-header"><h2 class="modal-title"><i class="fas fa-receipt"></i> Détails Commande</h2><button class="modal-close" onclick="closeDetail()">&times;</button></div>
        <div class="modal-body">
            <div class="detail-section">
                <div class="section-title"><i class="fas fa-tasks"></i> Statut</div>
                <div style="margin-bottom:1rem;"><span class="status-badge status-pending" id="detailStatusBadge">⏳ En attente</span></div>
                <div class="status-actions">
                    <button class="status-btn accept" onclick="updateOrderStatus('accepted')"><i class="fas fa-check"></i> Accepter</button>
                    <button class="status-btn ship" onclick="updateOrderStatus('shipped')"><i class="fas fa-truck"></i> Expédier</button>
                    <button class="status-btn deliver" onclick="updateOrderStatus('arrived')"><i class="fas fa-box"></i> Livrée</button>
                    <button class="status-btn return" onclick="updateOrderStatus('returned')"><i class="fas fa-undo"></i> Retour</button>
                </div>
            </div>
            <div class="detail-section">
                <div class="section-title"><i class="fas fa-user"></i> Client</div>
                <div class="detail-grid">
                    <div class="detail-item"><span class="detail-label">Nom</span><span class="detail-value" id="detailName">—</span></div>
                    <div class="detail-item"><span class="detail-label">Téléphone 1</span><span class="detail-value" id="detailPhone1">—</span></div>
                    <div class="detail-item"><span class="detail-label">Téléphone 2</span><span class="detail-value" id="detailPhone2">—</span></div>
                    <div class="detail-item"><span class="detail-label">Date</span><span class="detail-value" id="detailDate">—</span></div>
                </div>
            </div>
            <div class="detail-section">
                <div class="section-title"><i class="fas fa-map-marker-alt"></i> Livraison</div>
                <div class="detail-grid">
                    <div class="detail-item"><span class="detail-label">Type</span><span class="detail-value" id="detailOrderType">—</span></div>
                    <div class="detail-item"><span class="detail-label">Wilaya</span><span class="detail-value" id="detailWilaya">—</span></div>
                    <div class="detail-item"><span class="detail-label">Commune</span><span class="detail-value" id="detailCommune">—</span></div>
                </div>
            </div>
            <div class="detail-section">
                <div class="section-title"><i class="fas fa-box-open"></i> Produits</div>
                <div class="products-list" id="detailItems"><p style="text-align:center;color:var(--text-muted);">Aucun produit</p></div>
            </div>
            <div class="total-section">
                <div class="total-row"><span class="total-label">Sous-total</span><span class="total-value" id="detailCartTotal">0 DA</span></div>
                <div class="total-row"><span class="total-label">Livraison</span><span class="total-value" id="detailShipping">0 DA</span></div>
                <div class="total-row"><span class="total-label">Total</span><span class="total-value grand" id="detailTotal">0 DA</span></div>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Modal Ajouter Produit (URL GitHub) -->
<div class="modal" id="addProductModal">
    <div class="modal-content">
        <div class="modal-header"><h2 class="modal-title"><i class="fas fa-plus-circle"></i> Ajouter Produit</h2><button class="modal-close" onclick="closeAddProductModal()">&times;</button></div>
        <div class="modal-body">
            <form id="addProductForm">
                <div class="form-group"><label class="form-label">Nom *</label><input type="text" id="productName" class="form-input" required></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Catégorie *</label><select id="productCategory" class="form-select" required><option value="">Sélectionner...</option><option value="laptop">Laptop</option><option value="imprimantes">Imprimantes</option><option value="accessoires">Accessoires</option></select></div>
                    <div class="form-group"><label class="form-label">Prix (DA) *</label><input type="number" id="productPrice" class="form-input" required min="0" step="0.01"></div>
                </div>
                <div class="form-group"><label class="form-label">Description</label><textarea id="productDescription" class="form-textarea"></textarea></div>
                <div class="form-group">
                    <label class="form-label">Image URL (GitHub) *</label>
                    <input type="url" id="productImageUrl" class="form-input" placeholder="https://raw.githubusercontent.com/user/repo/main/image.jpg" required>
                    <small style="color:#94a3b8;display:block;margin-top:5px;"><i class="fas fa-info-circle"></i> Utilisez un lien Raw GitHub</small>
                    <div class="image-preview" id="imagePreview"></div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAddProductModal()">Annuler</button>
            <button class="btn btn-success" type="submit" form="addProductForm"><i class="fas fa-save"></i> Enregistrer</button>
        </div>
    </div>
</div>

<!-- ✅ Modal Modifier Produit (جديد) -->
<div class="modal" id="editProductModal">
    <div class="modal-content">
        <div class="modal-header"><h2 class="modal-title"><i class="fas fa-edit"></i> Modifier Produit</h2><button class="modal-close" onclick="closeEditProductModal()">&times;</button></div>
        <div class="modal-body">
            <form id="editProductForm">
                <div class="form-group"><label class="form-label">Nom *</label><input type="text" id="editProductName" class="form-input" required></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Catégorie *</label><select id="editProductCategory" class="form-select" required><option value="">Sélectionner...</option><option value="laptop">Laptop</option><option value="imprimantes">Imprimantes</option><option value="accessoires">Accessoires</option></select></div>
                    <div class="form-group"><label class="form-label">Prix (DA) *</label><input type="number" id="editProductPrice" class="form-input" required min="0" step="0.01"></div>
                </div>
                <div class="form-group"><label class="form-label">Description</label><textarea id="editProductDescription" class="form-textarea"></textarea></div>
                <div class="form-group">
                    <label class="form-label">Image URL (GitHub) *</label>
                    <input type="url" id="editProductImageUrl" class="form-input" placeholder="https://raw.githubusercontent.com/..." required>
                    <div class="image-preview" id="editImagePreview"></div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEditProductModal()">Annuler</button>
            <button class="btn btn-warning" type="submit" form="editProductForm"><i class="fas fa-save"></i> Mettre à jour</button>
        </div>
    </div>
</div>

<script src="admin.js"></script>
</body>
</html>
