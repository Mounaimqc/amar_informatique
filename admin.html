<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Amar Informatique</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* أضف هذا الستايل لدعم زر الواتساب */
        #detailWhatsappContainer { margin-top: 15px; text-align: center; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="logo">
            <i class="fas fa-shield-alt"></i> Amar Dashboard
        </div>
        <nav>
            <a href="index.html" class="nav-link"><i class="fas fa-store"></i> Boutique</a>
            <button onclick="logout()" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Déconnexion</button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <h1>Gestion des Commandes</h1>
        
        <!-- Actions -->
        <div class="admin-actions">
            <button onclick="openAddProductModal()" class="btn-primary">
                <i class="fas fa-plus"></i> Ajouter Produit
            </button>
            <button onclick="exportCommandes()" class="btn-secondary">
                <i class="fas fa-file-export"></i> Exporter CSV
            </button>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-shopping-cart"></i></div>
                <div class="stat-info">
                    <div class="stat-value" id="totalCommandes">0</div>
                    <div class="stat-label">Commandes Totales</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                <div class="stat-info">
                    <div class="stat-value" id="totalRevenu">0 DA</div>
                    <div class="stat-label">Revenu Total</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-home"></i></div>
                <div class="stat-info">
                    <div class="stat-value" id="totalDomicile">0</div>
                    <div class="stat-label">Livraison Domicile</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-store-alt"></i></div>
                <div class="stat-info">
                    <div class="stat-value" id="totalStopdesk">0</div>
                    <div class="stat-label">Stop Desk</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <input type="text" id="searchInput" placeholder="Rechercher (N°, Nom, Tél)...">
            <select id="filterType">
                <option value="">Type: Tous</option>
                <option value="domicile">Domicile</option>
                <option value="stopdesk">Stop Desk</option>
            </select>
            <select id="filterWilaya">
                <option value="">Wilaya: Toutes</option>
            </select>
            <button onclick="clearFilters()">Reset</button>
        </div>

        <!-- Table -->
        <div class="table-container">
            <h2>Liste des Commandes</h2>
            <table>
                <thead>
                    <tr>
                        <th>N° Commande</th>
                        <th>Client</th>
                        <th>Type</th>
                        <th>Wilaya</th>
                        <th>Total</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody">
                    <tr><td colspan="7" style="text-align:center; padding:40px;">Chargement...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Modal Détails -->
    <div class="modal" id="detailModal">
        <div class="modal-content modal-large">
            <button class="close-modal" onclick="closeDetail()">&times;</button>
            <h2>Détails Commande <span id="detailOrderNumber"></span></h2>
            
            <div class="detail-header">
                <div class="status-badge" id="detailStatusBadge">⏳ En attente</div>
                <div class="status-actions">
                    <button onclick="updateOrderStatus('accepted')" class="btn-accept">Accepter</button>
                    <button onclick="updateOrderStatus('shipped')" class="btn-ship">Expédier</button>
                    <button onclick="updateOrderStatus('arrived')" class="btn-deliver">Livrée</button>
                    <button onclick="updateOrderStatus('returned')" class="btn-return">Retour</button>
                </div>
            </div>

            <!-- حاوية زر الواتساب الجديدة -->
            <div id="detailWhatsappContainer"></div>

            <div class="detail-grid">
                <div class="detail-section">
                    <h3>Client</h3>
                    <p><strong>Nom:</strong> <span id="detailName">—</span></p>
                    <p><strong>Téléphone 1:</strong> <span id="detailPhone1">—</span></p>
                    <p><strong>Téléphone 2:</strong> <span id="detailPhone2">—</span></p>
                    <p><strong>Date:</strong> <span id="detailDate">—</span></p>
                </div>
                <div class="detail-section">
                    <h3>Livraison</h3>
                    <p><strong>Type:</strong> <span id="detailOrderType">—</span></p>
                    <p><strong>Wilaya:</strong> <span id="detailWilaya">—</span></p>
                    <p><strong>Commune:</strong> <span id="detailCommune">—</span></p>
                </div>
            </div>

            <div class="detail-section">
                <h3>Produits</h3>
                <div id="detailItems" class="items-list">Aucun produit</div>
            </div>

            <div class="detail-totals">
                <div class="total-row">
                    <span>Sous-total:</span>
                    <span><span id="detailCartTotal">0</span> DA</span>
                </div>
                <div class="total-row">
                    <span>Livraison:</span>
                    <span><span id="detailShipping">0</span> DA</span>
                </div>
                <div class="total-row total-final">
                    <span>Total:</span>
                    <span><span id="detailTotal">0</span> DA</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ajout Produit -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeAddProductModal()">&times;</button>
            <h2>Ajouter Produit</h2>
            <form id="addProductForm">
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Catégorie *</label>
                    <select id="productCategory" required>
                        <option value="">Sélectionner...</option>
                        <option value="Laptop">Laptop</option>
                        <option value="Imprimantes">Imprimantes</option>
                        <option value="Accessoires">Accessoires</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Prix (DA) *</label>
                    <input type="number" id="productPrice" required min="0">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="productDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Image *</label>
                    <input type="file" id="productImageFile" accept="image/*" required>
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeAddProductModal()" class="btn-cancel">Annuler</button>
                    <button type="submit" class="btn-submit">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase & Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <script>
        const firebaseConfig = {
            // ⚠️ ضع إعدادات Firebase الخاصة بك هنا
            apiKey: "API_KEY",
            authDomain: "PROJECT_ID.firebaseapp.com",
            projectId: "PROJECT_ID",
            storageBucket: "PROJECT_ID.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>
    
    <script src="admin.js"></script>
</body>
</html>
