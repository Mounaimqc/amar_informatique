<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="theme-color" content="#0f172a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Suivi de Commande - Amar Informatique</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="logo.jpg" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAUjSJTplPn9O8pK_YU5ydsyqUQ9HVfKXo",
      authDomain: "amar-informatique.firebaseapp.com",
      projectId: "amar-informatique",
      storageBucket: "amar-informatique.firebasestorage.app",
      messagingSenderId: "568367870390",
      appId: "1:568367870390:web:e1583c182272ecbf141117"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <style>
    /* ... (Gardez votre CSS actuel ici) ... */
    :root { --bg-dark: #0f172a; --bg-card: rgba(30, 41, 59, 0.7); --primary-color: #7c3aed; --primary-glow: #8b5cf6; --text-main: #f8fafc; --text-muted: #94a3b8; --success: #10b981; --danger: #ef4444; --glass-border: 1px solid rgba(255, 255, 255, 0.1); --neon-shadow: 0 0 15px rgba(124, 58, 237, 0.3); --radius-md: 12px; --radius-lg: 20px; --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Outfit', sans-serif; background-color: var(--bg-dark); color: var(--text-main); line-height: 1.6; min-height: 100vh; }
    .container { width: min(92%, 1400px); margin: 0 auto; padding: 0 1rem; }
    header { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); border-bottom: var(--glass-border); position: sticky; top: 0; z-index: 100; padding: 1rem 0; }
    .navbar .container { display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo img { height: 42px; }
    .btn-nav { padding: 10px 18px; border-radius: 12px; background: rgba(124, 58, 237, 0.1); color: var(--primary-color); text-decoration: none; border: 1px solid rgba(124, 58, 237, 0.3); }
    .tracking-container { max-width: 800px; margin: 40px auto; background: var(--bg-card); padding: 30px 25px; border-radius: var(--radius-lg); border: var(--glass-border); box-shadow: var(--neon-shadow); }
    .search-group { display: flex; gap: 12px; margin-bottom: 30px; }
    .search-input-tracking { flex: 1; padding: 14px 20px; border-radius: 50px; background: rgba(15, 23, 42, 0.6); color: white; border: 1px solid rgba(255, 255, 255, 0.1); }
    .search-btn { padding: 0 25px; background: var(--primary-color); color: white; border-radius: 50px; border: none; cursor: pointer; font-weight: 700; }
    .result-box { display: none; }
    .status-badge { padding: 8px 16px; border-radius: 50px; font-weight: 700; }
    .status-pending { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
    .status-accepted { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .status-shipped { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
    .status-arrived { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .timeline { position: relative; margin-top: 30px; padding-left: 25px; }
    .timeline-step { display: flex; align-items: flex-start; margin-bottom: 25px; opacity: 0.4; }
    .timeline-step.active, .timeline-step.completed { opacity: 1; }
    .timeline-dot { width: 18px; height: 18px; border: 2px solid var(--text-muted); border-radius: 50%; margin-right: 15px; }
    .active .timeline-dot { background: var(--primary-color); border-color: var(--primary-color); }
    .completed .timeline-dot { background: var(--success); border-color: var(--success); }
    #noResultBox { display: none; text-align: center; color: var(--danger); }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="container">
        <div class="logo">
          <img src="logo.jpg" alt="Logo">
          <h1>Amar Informatique</h1>
        </div>
        <a href="index.html" class="btn-nav"><i class="fas fa-arrow-left"></i> Retour</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <div class="tracking-container">
      <div style="text-align:center; margin-bottom:30px;">
        <h2>Suivi de Commande</h2>
        <p>Entrez votre numéro de commande</p>
      </div>

      <div class="search-group">
        <input type="text" id="orderIdInput" class="search-input-tracking" placeholder="Ex: AM260101001">
        <button id="trackBtn" class="search-btn">Rechercher</button>
      </div>

      <div id="resultBox" class="result-box">
        <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; margin-bottom:20px;">
          <p>Numéro: <span id="displayOrderId" style="font-weight:bold;"></span></p>
          <p>Total: <span id="displayOrderTotal"></span></p>
          <div style="text-align:center; margin-top:10px;">
            <span id="displayStatusBadge" class="status-badge"></span>
          </div>
        </div>

        <div class="timeline">
          <div class="timeline-step" id="step-pending">
            <div class="timeline-dot"></div>
            <div><h4>Commande Reçue</h4></div>
          </div>
          <div class="timeline-step" id="step-accepted">
            <div class="timeline-dot"></div>
            <div><h4>Confirmée</h4></div>
          </div>
          <div class="timeline-step" id="step-shipped">
            <div class="timeline-dot"></div>
            <div><h4>Expédiée</h4></div>
          </div>
          <div class="timeline-step" id="step-arrived">
            <div class="timeline-dot"></div>
            <div><h4>Livrée</h4></div>
          </div>
        </div>
      </div>

      <div id="noResultBox">Commande introuvable.</div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const trackBtn = document.getElementById('trackBtn');
      const orderIdInput = document.getElementById('orderIdInput');
      const resultBox = document.getElementById('resultBox');
      const noResultBox = document.getElementById('noResultBox');

      function trackOrder() {
        const orderId = orderIdInput.value.trim();
        if (!orderId) return;

        db.collection("commandes")
          .where("orderNumber", "==", orderId)
          .get()
          .then((snapshot) => {
            if (!snapshot.empty) {
              const data = snapshot.docs[0].data();
              showResult(data);
            } else {
              resultBox.style.display = 'none';
              noResultBox.style.display = 'block';
            }
          });
      }

      function showResult(data) {
        noResultBox.style.display = 'none';
        resultBox.style.display = 'block';
        document.getElementById('displayOrderId').textContent = data.orderNumber;
        document.getElementById('displayOrderTotal').textContent = (data.grandTotal || 0) + ' DA';
        
        const badge = document.getElementById('displayStatusBadge');
        badge.textContent = getStatusLabel(data.status);
        badge.className = 'status-badge status-' + (data.status || 'pending');

        updateTimeline(data.status || 'pending');
      }

      function getStatusLabel(s) {
        const labels = { 'pending':'En attente', 'accepted':'Acceptée', 'shipped':'En route', 'arrived':'Livrée' };
        return labels[s] || 'En attente';
      }

      function updateTimeline(status) {
        const steps = ['pending', 'accepted', 'shipped', 'arrived'];
        let currentFound = false;
        steps.forEach(s => {
          const el = document.getElementById('step-' + s);
          el.classList.remove('active', 'completed');
          if (s === status) { el.classList.add('active'); currentFound = true; }
          else if (!currentFound) { el.classList.add('completed'); }
        });
      }

      trackBtn.addEventListener('click', trackOrder);
      orderIdInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') trackOrder(); });
    });
  </script>
</body>
</html>
